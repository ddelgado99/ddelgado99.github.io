<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DOMBET ADMIN</title>
<style>
html{zoom:.9}
body{margin:0;font-family:Arial,sans-serif;background:#f4f6f8}
header{background:#0a1a3a;padding:16px 22px;color:#fff;display:flex;justify-content:space-between;align-items:center}
.container{max-width:1200px;margin:40px auto;padding:0 20px}
.btn{border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-weight:bold}
.btn-success{background:#25D366;color:#fff}
.btn-primary{background:#0a1a3a;color:#fff}
.btn-danger{background:#d32f2f;color:#fff}
.btn-warning{background:#ff9800;color:#fff}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden}
th,td{padding:14px;border-bottom:1px solid #eee}
th{background:#f8f9fa}
img{width:60px;height:60px;object-fit:contain}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);align-items:center;justify-content:center}
.modal-content{background:#fff;padding:30px;border-radius:12px;width:520px}
.form-group{margin-bottom:14px}
.form-control{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px}
</style>
</head>

<body>

<header>
  <strong>DOMBET ¬∑ ADMIN</strong>
  <button class="btn" onclick="location.href='index.html'">Ir a tienda</button>
</header>

<div class="container">
  <button class="btn btn-success" onclick="openModal()">+ Nuevo Producto</button>

  <table>
    <thead>
      <tr>
        <th>Img</th>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Desc.</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Producto</h3>

    <input type="hidden" id="pId">

    <div class="form-group">
      <input class="form-control" id="pName" placeholder="Nombre">
    </div>

    <div class="form-group">
      <input class="form-control" id="pPrice" type="number" placeholder="Precio">
    </div>

    <div class="form-group">
      <input class="form-control" id="pDiscount" type="number" placeholder="Descuento %">
    </div>

    <div class="form-group">
      <textarea class="form-control" id="pDesc" placeholder="Descripci√≥n"></textarea>
    </div>

    <div class="form-group">
      <input class="form-control" id="imgMain" placeholder="Imagen principal (URL)">
      <input class="form-control" id="img1" placeholder="Imagen miniatura 1 (URL)">
      <input class="form-control" id="img2" placeholder="Imagen miniatura 2 (URL)">
      <input class="form-control" id="img3" placeholder="Imagen miniatura 3 (URL)">
    </div>

    <button class="btn btn-primary" onclick="save()">Guardar</button>
    <button class="btn" onclick="closeModal()">Cancelar</button>
  </div>
</div>

<script>
const API = "https://dombet-backend.onrender.com/products"
let products = []

fetch(API)
  .then(r => r.json())
  .then(d => { products = d; render() })

function render(){
  list.innerHTML = products.map((p,i)=>`
    <tr>
      <td>
        <img src="${p.image_main || 'https://via.placeholder.com/60'}"
             onerror="this.src='https://via.placeholder.com/60'">
      </td>
      <td>${p.name}</td>
      <td>Gs ${Number(p.price).toLocaleString()}</td>
      <td>${p.discount || 0}%</td>
      <td>
        <button class="btn btn-warning" onclick="edit(${i})">‚úè</button>
        <button class="btn btn-danger" onclick="del(${p.id})">üóë</button>
      </td>
    </tr>
  `).join('')
}

function openModal(){
  modal.style.display='flex'
  modalTitle.innerText = "Nuevo Producto"
  pId.value = ""               // CLAVE
  pName.value = ""
  pPrice.value = ""
  pDiscount.value = ""
  pDesc.value = ""
  imgMain.value = ""
  img1.value = ""
  img2.value = ""
  img3.value = ""
}

function closeModal(){
  modal.style.display='none'
}

function edit(i){
  const p = products[i]
  modalTitle.innerText = "Editar Producto"
  pId.value = p.id
  pName.value = p.name
  pPrice.value = p.price
  pDiscount.value = p.discount
  pDesc.value = p.description
  imgMain.value = p.image_main
  img1.value = p.image_thumb1
  img2.value = p.image_thumb2
  img3.value = p.image_thumb3
  modal.style.display='flex'
}

function save(){
  if(!pName.value || !pPrice.value){
    alert("Nombre y precio son obligatorios")
    return
  }

  const data = {
    name: pName.value.trim(),
    price: Number(pPrice.value),
    discount: Number(pDiscount.value || 0),
    description: pDesc.value.trim(),
    image_main: imgMain.value.trim(),
    image_thumb1: img1.value.trim(),
    image_thumb2: img2.value.trim(),
    image_thumb3: img3.value.trim()
  }

  const id = pId.value.trim()
  const method = id ? 'PUT' : 'POST'
  const url = id ? `${API}/${id}` : API

  fetch(url,{
    method,
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  })
  .then(async r=>{
    if(!r.ok){
      const msg = await r.text()
      alert("Error backend: " + msg)
      return
    }
    location.reload()
  })
}

function del(id){
  if(confirm("Eliminar producto?")){
    fetch(`${API}/${id}`,{method:'DELETE'})
      .then(()=>location.reload())
  }
}
</script>

</body>
</html>
