<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DOMBET ADMIN</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Segoe UI;background:#121212;color:#fff;display:flex;height:100vh}
.left{flex:1;padding:15px;overflow:auto}
.right{width:380px;padding:15px;background:#1e1e1e}
input,textarea,button{width:100%;padding:10px;margin-bottom:10px}
button{background:#1976d2;color:#fff;border:0;border-radius:6px;font-weight:700}
.danger{background:#ef5350}
.product{display:flex;gap:10px;align-items:center;background:#1e1e1e;padding:10px;border-radius:6px;margin-bottom:10px;cursor:pointer}
.product img{width:45px;height:45px;object-fit:contain;background:#fff}
.preview{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.preview img{height:80px;object-fit:contain;background:#fff;border-radius:6px}
</style>
</head>
<body>

<div class="left" id="list"></div>

<div class="right">
<input type="hidden" id="id">
<input id="name" placeholder="Nombre">
<textarea id="desc" placeholder="Descripción"></textarea>

<input type="file" id="images" multiple accept="image/*">
<div class="preview" id="preview"></div>

<button onclick="save()">GUARDAR</button>
<button class="danger" onclick="del()">BORRAR</button>
</div>

<script>
const API="https://dombet-backend.onrender.com";

const list=document.getElementById("list");
const id=document.getElementById("id");
const name=document.getElementById("name");
const desc=document.getElementById("desc");
const images=document.getElementById("images");
const preview=document.getElementById("preview");

images.onchange=()=>{
  preview.innerHTML="";
  [...images.files].forEach(f=>{
    const i=document.createElement("img");
    i.src=URL.createObjectURL(f);
    preview.appendChild(i);
  });
};

async function load(){
  const d=await fetch(API+"/products").then(r=>r.json());
  list.innerHTML=d.map(p=>`
    <div class="product" onclick='edit(${JSON.stringify(p)})'>
      <img src="${p.image_main}">
      <div>${p.name}</div>
    </div>
  `).join("");
}
load();

function edit(p){
  id.value=p.id;
  name.value=p.name;
  desc.value=p.description;
  preview.innerHTML="";
  [p.image_main,p.image_thumb1,p.image_thumb2,p.image_thumb3]
    .filter(Boolean)
    .forEach(u=>{
      const i=document.createElement("img");
      i.src=u;
      preview.appendChild(i);
    });
}

async function save(){
  const fd=new FormData();
  fd.append("name",name.value);
  fd.append("description",desc.value);
  [...images.files].forEach(f=>fd.append("images",f));

  const url=id.value?`${API}/products/${id.value}`:`${API}/products`;
  const method=id.value?"PUT":"POST";

  const r=await fetch(url,{method,body:fd});
  if(!r.ok){alert("Error");return;}
  reset();load();
}

async function del(){
  if(!id.value||!confirm("¿Borrar?"))return;
  await fetch(`${API}/products/${id.value}`,{method:"DELETE"});
  reset();load();
}

function reset(){
  id.value="";name.value="";desc.value="";
  images.value="";preview.innerHTML="";
}
</script>

</body>
</html>
