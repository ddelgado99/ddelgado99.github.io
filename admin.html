<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN DOMBET</title>

<style>
*{box-sizing:border-box}
:root{
  --primary:#1976d2;
  --accent:#ef5350;
  --bg:#121212;
  --surface:#1e1e1e;
  --text:#e0e0e0;
  --border:#333;
  --input:#2c2c2c;
}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
}
#loginScreen{
  position:fixed;inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  background:var(--bg);
}
.login-card{
  background:var(--surface);
  padding:30px;
  border-radius:10px;
  width:320px;
}
.login-card input,button{
  width:100%;
  padding:12px;
  margin-bottom:10px;
}
button{
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
}
#adminContent{display:none;flex:1;flex-direction:column}
header{
  background:var(--surface);
  padding:15px;
  font-weight:900;
}
.main{
  flex:1;
  display:flex;
  overflow:hidden;
}
.product-list{
  flex:1;
  overflow:auto;
  padding:15px;
  border-right:1px solid var(--border);
}
.product-item{
  background:var(--surface);
  padding:10px;
  border-radius:8px;
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:10px;
  cursor:pointer;
}
.product-item img{
  width:45px;height:45px;
  object-fit:contain;
  background:#fff;
  border-radius:4px;
}
.editor{
  width:400px;
  padding:15px;
  background:var(--surface);
  overflow:auto;
}
input,textarea{
  width:100%;
  padding:10px;
  background:var(--input);
  border:1px solid var(--border);
  color:var(--text);
  margin-bottom:10px;
}
.preview-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
  gap:8px;
}
.preview-grid img{
  width:100%;
  height:80px;
  object-fit:contain;
  background:#fff;
  border-radius:4px;
}
.btn-danger{
  background:var(--accent);
}
</style>
</head>

<body>

<div id="loginScreen">
  <div class="login-card">
    <input id="loginUser" placeholder="Usuario">
    <input id="loginPass" type="password" placeholder="Contraseña">
    <button onclick="login()">ENTRAR</button>
  </div>
</div>

<div id="adminContent">
<header>DOMBET ADMIN</header>

<div class="main">
  <div class="product-list" id="adminList"></div>

  <div class="editor">
    <input type="hidden" id="prodId">

    <input id="prodName" placeholder="Nombre">
    <textarea id="prodDesc" rows="4" placeholder="Descripción"></textarea>

    <input type="file" id="prodImgFile" accept="image/*" multiple>
    <div class="preview-grid" id="imgPreview"></div>

    <button onclick="saveProduct()">GUARDAR</button>
    <button class="btn-danger" onclick="deleteProduct()">BORRAR</button>
  </div>
</div>
</div>

<script>
const API = "https://dombet-backend.onrender.com";
const SESSION = "admin_session";

const loginScreen = document.getElementById("loginScreen");
const adminContent = document.getElementById("adminContent");

const prodId = document.getElementById("prodId");
const prodName = document.getElementById("prodName");
const prodDesc = document.getElementById("prodDesc");
const prodImgFile = document.getElementById("prodImgFile");
const imgPreview = document.getElementById("imgPreview");
const adminList = document.getElementById("adminList");

function login(){
  if(loginUser.value==="admin" && loginPass.value==="3lma3stro"){
    sessionStorage.setItem(SESSION,"ok");
    loginScreen.style.display="none";
    adminContent.style.display="flex";
    loadProducts();
  }
}

if(sessionStorage.getItem(SESSION)){
  loginScreen.style.display="none";
  adminContent.style.display="flex";
  loadProducts();
}

// PREVIEW MULTIPLE
prodImgFile.onchange=()=>{
  imgPreview.innerHTML="";
  [...prodImgFile.files].forEach(f=>{
    const img=document.createElement("img");
    img.src=URL.createObjectURL(f);
    imgPreview.appendChild(img);
  });
};

// CREATE / UPDATE
async function saveProduct(){
  if(!prodName.value) return alert("Nombre requerido");

  const fd = new FormData();
  fd.append("name",prodName.value);
  fd.append("description",prodDesc.value);

  [...prodImgFile.files].forEach(f=>{
    fd.append("images",f);
  });

  const method = prodId.value ? "PUT" : "POST";
  const url = prodId.value
    ? `${API}/products/${prodId.value}`
    : `${API}/products`;

  const res = await fetch(url,{method,body:fd});
  if(!res.ok) return alert("Error");

  resetForm();
  loadProducts();
}

// DELETE
async function deleteProduct(){
  if(!prodId.value) return;
  if(!confirm("¿Borrar producto?")) return;

  const res = await fetch(`${API}/products/${prodId.value}`,{method:"DELETE"});
  if(!res.ok) return alert("Error al borrar");

  resetForm();
  loadProducts();
}

// LOAD
function loadProducts(){
  fetch(API+"/products")
  .then(r=>r.json())
  .then(d=>{
    adminList.innerHTML=d.map(p=>`
      <div class="product-item" onclick='editProduct(${JSON.stringify(p)})'>
        <img src="${p.image_main}">
        <div>${p.name}</div>
      </div>
    `).join("");
  });
}

// EDIT
function editProduct(p){
  prodId.value=p.id;
  prodName.value=p.name;
  prodDesc.value=p.description;

  imgPreview.innerHTML="";
  (p.images||[]).forEach(url=>{
    const img=document.createElement("img");
    img.src=url;
    imgPreview.appendChild(img);
  });
}

// RESET
function resetForm(){
  prodId.value="";
  prodName.value="";
  prodDesc.value="";
  prodImgFile.value="";
  imgPreview.innerHTML="";
}
</script>

</body>
</html>
